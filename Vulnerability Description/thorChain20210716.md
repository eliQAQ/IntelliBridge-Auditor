## 漏洞分析

黑客钱包: 0x3a196410a0f5facd08fd7880a4b8551cd085c031

合约地址: 0x4a33862042d004d3fc45e284e1aafa05b48e3c9c

Tornado地址: 0x4b713980d60b4994e0aa298a66805ec0d35ebc5a

根据ThorChain的初步事故报告，该漏洞位于ETH Bifrost（桥）代码中。

该代码包含一个重写循环，只设计用于vaultTransferEvent交易，黑客能够操纵它。黑客能够用他们自己的合约来包装路由器，使他们能够访问这个重写。

![](https://raw.githubusercontent.com/RektHQ/Assets/main/images/2021/7/thor-code.png)

发送一笔调用值为0和充值数为0的交易。然而，重写循环导致交易的msg.value（设置为200）被误读为txvalue（）。

然后该漏洞被循环使用，耗尽了各种币的流动性：

2,500 ETH 57,975.33 sushi 8.7365 YFI 171,912.96 DODO 514.519 ALCX 1,167,216.739 KLY 13.30 AAVE

尽管代码中包含一个注释，明确指出...

"//把这部分放在上述循环之外很重要"

......这个漏洞一直公开，看起来是ThorChain团队的一个昂贵的疏忽。

根据该事件报告：

"修复方法是，只有当它是一个特定vaultTransferEvent时，才会发生重写"

这似乎是早就可以预见和预防的事情。

## 参考链接

https://rekt.news/zh/thorchain-rekt

https://thearchitect.notion.site/THORChain-Incident-07-15-7d205f91924e44a5b6499b6df5f6c210