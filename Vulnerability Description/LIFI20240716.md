该漏洞为2024 年 7 月 16 日发生在LI.FI合约合约上面的攻击，原因在于被攻击合约对攻击者传入参数校验不严格，导致攻击者可以通过构造特殊inputData来使受害者合约调用任意合约并传入任意参数。最终，攻击者利用特殊的参数，使得受害者合约通过transferFrom将授权给其合约的代币转入到攻击者控制的地址。

首先`GasZipFacet\src\Facets\GasZipFacet.sol`中的depositToGasZipERC20调用了`GasZipFacet\src\Libraries\LibSwap.sol`的LibSwap.swap函数：

![](https://img.picui.cn/free/2025/04/17/6800866666c62.png)

SwapData的结构如下：

![](https://img.picui.cn/free/2025/04/17/68008678e2bb8.png)

LibSwap.swap函数如下：

![](https://img.picui.cn/free/2025/04/17/68008674d0335.png)

swap函数执行以下步骤：

1. 验证：检查callTo地址是否为合约，以及fromAmount是否大于零。
2. 余额检查：确保合约具有足够的sendingAssetId余额以执行交换。
3. 批准：如果必要，则向approveTo地址批准fromAmount的sendingAssetId。
4. 低级调用：使用提供的callData对callTo合约进行低级调用。
5. 发出事件：如果成功，则发出包含交换详情的AssetSwapped事件。

只要控制了swap函数的参数_swap，既就可以利用LI.FI Protocol合约调用任意合约，传入任意参数，攻击者通过传入transferFrom作为callData利用LI.FI Protocol将授权给LI.FI的合约中的代币转移给自己

## 相关信息
攻击者地址：  
0x8b3cb6bf982798fba233bca56749e22eec42dcf3  
攻击者恶意合约：  
0x3c81476d4294070eb80f2f45fa5bdd237d4f3176  
被利用的合约：  
GasZipFacet: 0xf28a352377663ca134bd27b582b1a9a4dad7e534

## 参考资料
<https://learnblockchain.cn/article/12772>