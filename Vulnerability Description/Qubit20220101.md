## 漏洞分析

Qubit允许跨链抵押，通过QBridge存款功能锁定以太坊上的资产，以便在BSC上贷款。

攻击者利用代码中的一个逻辑错误，不必在以太坊上存入ETH就能在BSC上使用xETH。

攻击者的以太坊地址在2022年1月27日下午21:30+UTC左右开始攻击，资金是前不久从Tornado Cash转入的。

来自Qubit团队的事后总结：

攻击者在以太坊网络上调用QBridge存款功能，该功能调用存款函数QBridgeHandler。

QBridgeHandler应该收到WETH代币，也就是原来的tokenAddress，如果执行交易的人没有WETH代币，就不应该发生转账。

tokenAddress.safeTransferFrom(Deposit, address(this), amount)。

在上面的代码中，tokenAddress是0，所以safeTransferFrom没有失败，无论金额多少，存款函数都正常结束。

此外，tokenAddress在加入depositETH之前是WETH地址，但随着depositETH的加入，它被替换为零地址，也就是ETH的tokenAddress。

总而言之，在depositETH新开发后，存款功能是一个不应该使用的功能，但它仍然留在合约中。

根据Certik的分析：

漏洞的根源之一是tokenAddress.safeTransferFrom()在tokenAddress为零（空）地址（0x0...000）时没有回退。

尽管在以太坊合约中没有锁定任何ETH，但攻击者的BSC地址现在可以获得77162个qXETH（价值1.85亿美元），作为Qubit上贷款的抵押品。

他们用该抵押品来借WETH，BTC-B，美元稳定币，以及CAKE，BUNNY和MDX，然后把所有币换成20万个BNB（约8000万美元），这些钱仍然在BSC地址中。

## 参考链接

https://rekt.news/zh/qubit-rekt

https://medium.com/@QubitFin/protocol-exploit-report-305c34540fa3